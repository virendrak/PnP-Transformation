# Migrate InfoPath XML to SharePoint list items #

### Summary ###
This is a client-side Console application that reads input .csv file and it filters non-empty data of “Authentication” column. It iterates filtered data and reads each of the udcx file, and then comments the <udc:Authentication> node if present. A status report .csv file is generated at the end of the application, which will show whether the nodes are being commented for each file or not.

### Applies to ###
-  Office 365
-  SharePoint 2013/2016 on-premises


### Solution ###
Solution | Author(s)
---------|----------
UdcxRemediation.Console | Ron Tielke, Raja Shekar Bhumireddy, Bert Jansen (**Microsoft**)

### Version history ###
Version  | Date | Comments
---------| -----| --------
1.0  | February 4th 2016 | Initial release

### Disclaimer ###
**THIS CODE IS PROVIDED *AS IS* WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED, INCLUDING ANY IMPLIED WARRANTIES OF FITNESS FOR A PARTICULAR PURPOSE, MERCHANTABILITY, OR NON-INFRINGEMENT.**


----------

# Introduction#
This is a client-side Console application that reads input .csv file and it filters non-empty data of “Authentication” column. It iterates filtered data and reads each of the udcx file, and then comments the <udc:Authentication> node if present. A status report .csv file is generated at the end of the application, which will show whether the nodes are being commented for each file or not. 

# Usage #
## Authentication ##

### App-Only authentication
Specify that you want to use app-only in the configuration file like shown below:

```XML
<appSettings>
    <!-- Set to "true" if you wish to use App-only authentication -->
    <!-- Set to "false" if you wish to use User authentication -->
    <add key="UseAppModel" value="true" />

    <!-- Configure the following Client keys if you wish to use App Registration Mode -->
    <!--
    Minimum App Permissions required on target site collection that hosts the InfoPath form:
    <AppPermissionRequests AllowAppOnlyPolicy="true">
      <AppPermissionRequest Scope="http://sharepoint/content/tenant" Right="FullControl" />
    </AppPermissionRequests>

    <add key="ClientId" value="obtain from AppRegNew.aspx" />
    <add key="ClientSecret" value="obtain from AppRegNew.aspx" />
    -->
    <add key="ClientId" value="your client id" />
    <add key="ClientSecret" value="your client secret" />
</appSettings>
```

### Credentials authentication
The console will prompt the user for an administration account.  
Be sure to specify an account that has Admin permissions on the target SharePoint environment.  This account will be used to generate Authenticated User Context instances that will be leveraged to access the target environments.
- If you wish to target an SPO-D (or On-Prem) farm: 
    - use the <domain>\<alias> format for the administrator account
- If you wish to target an SPO-MT (or vNext) farm:
    - use the <alias>@<domain>.com format for the administrator account

Example is shown in the below screen shot:  

![](http://i.imgur.com/NT51RMx.png)

## Other Inputs to be provided on Command prompt ##
The console will also prompt the user for the input file path.

Be sure to specify the input file path in the following format:
- If you wish to target an SPO-D (or On-Prem) farm: 
    - use the <folder path containing the file>\<csv file name> format for the input file path
- Example: 
    - One such example is as shown in the figure: 

![](http://i.imgur.com/wl2ZKot.png)

**Note:**
If the path entered is incorrect or the file doesn’t exist, or nothing is entered, then respective error message is shown and it will again prompt for the file path. This can be shown in the below figure:

![](http://i.imgur.com/Dg8SLfv.png)

## Operation – CommentUDCXFileNodes ##
This operation reads data from an input file and iterates through each row and connects to corresponding site collection. It reads the udcx file and comments out the <udc:Authentication> node, if it is present or not commented already. (Based on the column ‘Authentication’ in the input csv file)
Also it generates status report indicating whether the commenting of the nodes was successful or not.

### Input - Udcxreport.csv ###

The file defines the udcx files of interest and is generated by the script: Get-UdcxReport.ps1. This is a CSV that follows in which the header row is atleast expected with the following format and columns: SiteId, WebId, DirName, LeafName, Id, SiteUrl, WebUrl, Authentication:
- **SiteId**: This column should contain the GUID of the site
- **WebId**: This column should contain the GUID of the Web
- **DirName**: This column should contain the serverRelative path of the data connection library where the .udcx file is present.
- **LeafName**: This column should contain the name of the .udcx file
- **Id**: This column should contain the GUID of the .udcx file
- **SiteUrl**: This column should contain the Url of the site
- **WebUrl**: This column should contain the Url of the Web.
- **Authentication**: This column should contain the data present in the <udc:Authentication> node in the .udcx file

See [UDCXReport.csv](/InfoPath/Migration/UdcxRemediation.Console/UDCXReport.csv) for a report sample.

### Output - UDCXStatusReport_dd_mm_yyyy_hh_mm_ss.csv ###
A status report .csv file is generated at the end of the application, which will show whether the nodes are being commented for each file or not. 

**Note:** 
This file will be generated in the same folder where the input file is present.

This CSV that follows the header format and columns as mentioned below: Status, ErrorDetails, DirName, LeafName, Id, SiteUrl, WebUrl, Authentication:

- **Status**: This column contains the Status of commenting the node which will be either ‘Success’ or ‘Error’ depending on the status of the .udcx file
- **ErrorDetails**: This column contains Error Details or Message if the commenting of the desired node is unsuccessful. On the success of the same, the corresponding data would be blank.
- **DirName**: This column contains the serverRelative path of the data connection library where the .udcx file is present.
- **LeafName**: This column contains the name of the .Udcx file
- **Authentication**: This column contains the data present in the <udc:Authentication> node in the .udcx file
- **Id**: This column contains the GUID of the .udcx file
- **SiteUrl**: This column contains the Url of the site
- **WebUrl**: This column contains the Url of the Web.

See [UDCXStatusReport_28_12_2015_10_24_59.csv](/InfoPath/Migration/UdcxRemediation.Console/UDCXStatusReport_28_12_2015_10_24_59.csv) for an status report sample.

<img src="https://telemetry.sharepointpnp.com/pnp-transformation/infopath/migration/UdcxRemediation.Console" /> 

